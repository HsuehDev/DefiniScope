# 檔案管理功能測試策略概述

## 測試目標

針對系統檔案管理功能，特別是檔案列表顯示和刪除操作，設計並實施全面的測試方案，確保功能正確性、用戶交互流暢性和資料一致性。

## 測試範圍

本測試方案涵蓋以下功能和流程：

1. **檔案列表顯示與排序**
   - 檔案基本資訊顯示（名稱、大小、上傳時間）
   - 檔案處理狀態顯示
   - 檔案統計資訊顯示（句子數、CD/OD數量）
   - 按名稱和日期的排序功能

2. **檔案刪除操作**
   - 刪除確認對話框
   - 檔案刪除操作的用戶交互
   - 刪除成功和失敗的處理
   - 關聯資料的級聯刪除

3. **資料處理與狀態更新**
   - 樂觀更新機制
   - 錯誤處理與回滾
   - UI更新一致性

## 測試策略分層

測試方案採用分層測試策略，從小到大涵蓋不同層級的測試：

### 1. 單元測試

**目標**：測試個別組件的渲染和基本邏輯

**測試檔案**：
- `FileList.test.tsx`：測試檔案列表顯示和排序功能
- `DeleteConfirmDialog.test.tsx`：測試刪除確認對話框的交互

**技術**：
- Vitest 測試框架
- React Testing Library
- 模擬的數據和API回應

**覆蓋範圍**：
- 元件渲染正確性
- 狀態更新和顯示
- 用戶交互（排序、點擊按鈕）

### 2. 整合測試

**目標**：測試多個組件協同工作和與API的互動

**測試檔案**：
- `FileManagement.test.tsx`：測試檔案列表與刪除功能的整合

**技術**：
- 模擬 API 回應和狀態
- React Query 的狀態管理
- 可控制的 Promise 測試異步操作

**覆蓋範圍**：
- 完整的刪除流程
- 樂觀更新機制
- 錯誤處理和復原
- API調用與UI一致性

### 3. 端到端測試

**目標**：模擬真實用戶使用場景，測試完整系統的互動

**測試檔案**：
- Playwright 測試腳本

**技術**：
- Playwright 測試框架
- 真實後端和資料庫
- 網絡請求攔截與模擬

**覆蓋範圍**：
- 完整用戶流程
- 資料持久化
- 跨頁面資料一致性
- 真實網絡條件下的性能

## 特殊測試焦點

### 1. 樂觀更新與錯誤回滾

特別設計了測試方案測試React Query的樂觀更新機制：
- 測試檔案在刪除前立即從UI移除
- 測試API失敗時如何回滾UI狀態
- 測試錯誤訊息顯示

實現方法：
- 使用可控制的Promise模擬異步API
- 模擬不同階段的數據狀態
- 在測試中精確控制解析或拒絕Promise的時機

### 2. 刪除確認交互

針對用戶確認流程的測試：
- 測試取消和確認按鈕的行為
- 測試載入狀態下的按鈕禁用
- 測試對話框的出現和消失

### 3. 資料級聯刪除

測試刪除檔案後相關資料的清理：
- 測試跨頁面引用的正確刪除
- 驗證刪除後的資料一致性

## 模擬與工具

### 1. API 模擬

創建了完整的API模擬機制：
- `useFileAPI.ts` 的模擬版本
- 可配置的成功/失敗響應
- 可控制的異步操作

### 2. 測試數據

設計了多種測試數據場景：
- 正常檔案
- 處理失敗的檔案
- 不同大小和內容的檔案

### 3. 測試環境配置

完整的測試環境配置：
- `setupTests.ts` 設置全局測試環境
- `vitest.config.ts` 配置測試框架
- 模擬瀏覽器API（localStorage等）

## 測試自動化與CI整合

設計了完整的CI/CD整合方案：
- GitHub Actions工作流程
- 自動化測試執行
- 覆蓋率報告生成
- 測試結果收集與展示

## 測試度量與成功標準

明確定義了測試的成功標準：
- 代碼覆蓋率要求（行、分支、函數）
- 關鍵流程測試覆蓋
- 邊界情況和錯誤處理覆蓋

## 結語

本測試方案通過多層次測試策略，全面覆蓋檔案管理功能，特別關注用戶交互體驗和資料操作的正確性。從單元測試到端到端測試，確保系統在各種條件下都能穩定正確運行，提供高質量的使用者體驗。 