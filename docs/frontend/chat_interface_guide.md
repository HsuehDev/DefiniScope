# 聊天介面設計與使用指南

## 1. 功能概述

聊天介面是文件分析平台的核心互動部分，提供用戶與系統進行智能問答的能力。此介面具有以下主要功能：

- 與系統進行自然語言對話
- 查看系統回答中的原文引用
- 實時跟踪查詢處理進度
- 查看系統參考的原文句子
- 直接跳轉查看PDF中的引用句子

## 2. 界面組成

### 2.1 主要組件

聊天界面由以下主要組件構成：

- **聊天容器（ChatContainer）**：整體聊天區域，包含消息列表和輸入區
- **消息氣泡（ChatMessage）**：顯示用戶問題和系統回覆
- **引用展示（ReferenceDisplay）**：顯示引用的原文句子
- **輸入框（ChatInput）**：用戶輸入問題的區域
- **處理進度顯示**：顯示系統處理問題的進度和步驟
- **PDF預覽模態框**：查看PDF中的原文句子

### 2.2 視覺設計

- 用戶消息使用藍色背景、白色文字顯示，位於右側
- 系統回覆使用白色背景、深色文字顯示，位於左側
- 引用句子根據其類型使用不同顏色標示：
  - 概念型定義（CD）：藍色
  - 操作型定義（OD）：綠色
  - 一般句子：灰色
- 處理進度使用進度條和步驟說明文字直觀顯示

## 3. 互動功能

### 3.1 訊息輸入

- 在輸入框中輸入問題文字
- 按 `Enter` 鍵發送消息
- 按 `Shift+Enter` 鍵換行（用於撰寫多行問題）
- 消息處理過程中，輸入框將被禁用

### 3.2 引用交互

- 點擊系統回答中的引用卡片，可打開原文PDF預覽
- 在預覽中可查看完整上下文和來源信息
- 系統回答中引用的句子在PDF中會被高亮顯示

### 3.3 處理進度查看

- 系統處理問題過程中，實時顯示進度百分比
- 顯示當前處理步驟（提取關鍵詞、搜索資料庫、生成答案等）
- 顯示系統正在參考的句子，點擊可以直接預覽原文

### 3.4 消息導航

- 長對話中提供自動滾動到底部功能
- 有新消息時顯示提示，一鍵跳轉到最新消息
- 消息列表支持手動滾動查看歷史消息

## 4. WebSocket實時更新

整個聊天界面與後端通過WebSocket保持實時連接，實現以下功能：

- 實時顯示處理進度和步驟
- 即時展示系統參考的句子
- 不需要手動刷新即可獲取最新處理狀態
- 自動重連機制，確保連接穩定

## 5. 使用流程

### 5.1 發起新對話

1. 進入聊天頁面
2. 在輸入框中輸入問題
3. 按Enter鍵發送問題
4. 查看系統處理進度
5. 獲得系統回答和相關引用

### 5.2 查看引用來源

1. 在系統回答中找到引用卡片
2. 點擊卡片查看詳情
3. 在預覽中查看完整PDF頁面和上下文
4. 關閉預覽返回對話

### 5.3 繼續對話

1. 在同一對話中繼續輸入問題
2. 系統將保持上下文連貫性
3. 每個問題都可以引用之前上傳的文件

## 6. 技術實現要點

- 使用React函數組件和hooks實現
- 採用TypeScript確保類型安全
- 使用TailwindCSS實現響應式布局
- 基於WebSocket實現實時通信
- 使用自定義hooks封裝WebSocket邏輯
- 響應式設計適配不同設備尺寸
- 處理長消息和多行文本的顯示 