# 進度顯示組件測試方案

## 1. 需求分析

進度顯示系統是用戶與後端處理流程交互的關鍵界面，它需要:
- 清晰顯示不同處理階段和狀態（待處理、處理中、完成、失敗）
- 實時更新進度信息
- 提供詳細的處理結果展示
- 妥善處理異常情況

## 2. 測試策略

### 2.1 測試層次

- **單元測試**：針對各子組件的獨立功能進行測試
- **整合測試**：測試組件間的交互與WebSocket數據流
- **視覺回歸測試**：確保UI在不同狀態下的正確顯示

### 2.2 測試工具

- **Vitest**: 單元測試框架
- **Testing Library**: DOM測試工具
- **Mock Service Worker**: API模擬 (WebSocket)

## 3. 測試方案

### 3.1 ProgressDisplay組件測試

ProgressDisplay組件是進度顯示的基本單元，測試內容包括:

1. 四種狀態的正確顯示（待處理、處理中、完成、失敗）
2. 進度條寬度與百分比的準確性
3. 進度數值的四捨五入邏輯
4. 錯誤信息的顯示
5. 根據狀態變化的顏色差異
6. 組件樣式類的處理

### 3.2 SentencePreview組件測試

SentencePreview組件負責展示單個句子信息，測試內容包括:

1. 基本句子信息顯示（句子內容、頁碼）
2. 不同定義類型的標籤顯示 (概念型/操作型)
3. 句子來源信息展示
4. 相關度和分類理由的正確顯示
5. 長句子的截斷處理
6. 點擊事件處理
7. 自定義樣式

### 3.3 DetailPanel組件測試

DetailPanel組件負責組織和展示處理結果詳情，測試內容包括:

1. 已提取句子的顯示和折疊功能
2. 已分類句子的顯示和類型標識
3. 關鍵詞和定義統計的正確呈現
4. 搜尋結果的分組和顯示
5. 參考句子列表的正確渲染
6. 句子點擊事件的處理
7. 各區段的展開/折疊功能

### 3.4 ProcessingProgress組件測試

ProcessingProgress是主要的整合組件，測試內容包括:

1. 根據狀態渲染不同的進度視圖
2. 文件處理與查詢處理模式的切換
3. 詳細信息面板的展開/折疊功能
4. 對錯誤情況的優雅處理
5. WebSocket連接錯誤的顯示和降級處理
6. 剩餘時間的顯示與計算

### 3.5 WebSocket整合測試

測試WebSocket事件處理與UI更新的整合，測試內容包括:

1. 模擬不同階段的WebSocket事件
2. 驗證UI是否正確響應狀態變化
3. 測試錯誤處理和恢復機制
4. 確認數據流與UI更新的同步性

## 4. 測試數據準備

### 4.1 模擬數據

- 各種狀態的進度數據
- 不同定義類型的句子數據
- 多種格式的搜尋結果
- 包含錯誤信息的處理結果

### 4.2 邊界情況

- 進度值為0%和100%的情況
- 空結果集的處理
- 超長文字的截斷顯示
- 極端值（如非常多的句子）的性能表現

## 5. 視覺回歸測試

使用Storybook或類似工具建立各組件的狀態庫，包括:

1. 所有進度狀態的視覺效果
2. 不同定義類型的句子卡片樣式
3. 各種數據量下的詳細面板佈局
4. 錯誤狀態的視覺反饋

## 6. 交互測試

1. 檢查各折疊區段的展開/收起功能
2. 句子點擊事件與詳情顯示
3. 進度跳轉時的動畫效果
4. 錯誤狀態下的用戶操作選項

## 7. 性能考量

1. 大量句子數據（50+）時的渲染性能
2. 實時更新時的UI響應速度
3. WebSocket連接失敗後的降級策略性能
4. 動畫過渡的流暢度測試

## 8. 測試維護

1. 建立模擬數據庫以方便測試重用
2. 整合到CI/CD流程
3. 定期更新視覺基準測試
4. 自動化測試報告 